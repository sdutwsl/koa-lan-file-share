<html>

<head>
    <title>目录树</title>
</head>

<body>
    <div>
        <ul id="Explorer">
            <li>
                <div>
                    <a href="#">..</a>
                    <span style="color:red;">dir</span>
                </div>
            </li>
        </ul>
        <div id="404" style="display: none;">
            <p>This dir is <strong>Not Found</strong>.</p>
        </div>
    </div>
    <template id="FileItem">
        <li>
            <div>
                <a href="#"></a>
                <span style="color:red;"></span>
            </div>
        </li>
    </template>
    <script>
        //服务端地址
        const server_url = "http://localhost:3000"
        //服务端文件夹树
        let server_dirs=null

        //获取浏览器路径
        const get_hash_dirs=()=>{
            let dirs = window.location.hash.substr(1, window.location.hash.length).split("/")
            //多输入了/的情况
            for(let d=0;d<dirs.length;d++){
                if(dirs[d]===""){
                    dirs.splice(d,1)
                    d--
                }
            }
            return dirs
        }

        //根据浏览器的文件夹获取服务器的文件夹及子文件
        const get_current_dir = (server_dir,dirs) => {
            let not_found = false
            for (let dir in dirs) {
                let aim_dir = server_dir.subs.find(d => d.name === dirs[dir])
                if (aim_dir) {
                    server_dir = aim_dir
                    continue
                } else {
                    not_found = true
                    break
                }
            }
            if (!not_found) {
                return server_dir
            } else {
                return undefined
            }
        }

        //绑定hash改变事件
        window.onhashchange=()=>{
            let current_dir=get_current_dir(server_dirs,get_hash_dirs())
            //服务端没有输入的文件夹
            if(!current_dir){
                console.log("Not Found!")
            }else{
                render_lists(current_dir)
            }
        }

        const render_lists=dir=>{
            dir.subs.forEach(element => {
            });
        }
        //获取服务端文件树
        fetch(server_url + "/ListFiles").then(res => {
            if (res.status == 200) {
                res.json().then(obj => {
                    server_dirs=obj
                    //触发一次渲染
                    window.onhashchange()
                })
            }
        })
    </script>
</body>

</html>